//asw.c


#include "bsw.h"
ISR2(TimerISR)
{
	static long c=-4;
	if(c==0)
	{
		ActivateTask(Task1);
	}
		printfSerial("\n%4ld: ",c++);
}
TASK(Task1){

   printfSerial("Task Begins...\n");
   mdelay(3000);
   ActivateTask(Task2);
   printfSerial("Task Finishes...\n");
   TerminateTask();
}

TASK(Task2){
	printfSerial("Task2 Begins...\n");
	mdelay(3000);
	printfSerial("Task2 Finishes...\n");
	 ChainTask(Task3);

}
TASK(Task3){
	printfSerial("Task3 Begins...\n");
	mdelay(3000);
	printfSerial("Task3 Finishes...\n");
	TerminateTask();

}




//conf.oil

CPU mySystem {
    OS myOs {
		EE_OPT = "OS_EE_APPL_BUILD_DEBUG";
		EE_OPT = "OS_EE_BUILD_DEBUG";

        USERESSCHEDULER = TRUE;
        CPU_DATA = AVR8 {
            MULTI_STACK = FALSE;
        };
        MCU_DATA = MEGA {
            MODEL = MEGA_328p;
        };
        LIB = ARDUINO {
            SDK_BOARD = UNO;
            VARIANT = CC {
                VERSION = "1.8.5";
            };
            STAND_ALONE = TRUE;        // Generate arduino libraries
        };
        KERNEL_TYPE = OSEK {
            CLASS = ECC2;    // Default
        };
    };
    
    APPDATA myApp {
        APP_SRC = "bsw.cpp";
        APP_SRC = "asw.c";
    };
    
    TASK Task1{
       PRIORITY = 1;
       STACK = SHARED;
       SCHEDULE = FULL;
       AUTOSTART = FALSE;
       ACTIVATION = 1;
    };
    
   
    
    TASK Task2{
    	PRIORITY = 2;
       STACK = SHARED;
       SCHEDULE = FULL;
       AUTOSTART = FALSE;
       ACTIVATION = 1;
    };
    
      TASK Task3{
    	PRIORITY = 3;
       STACK = SHARED;
       SCHEDULE = FULL;
       AUTOSTART = FALSE;
       ACTIVATION = 1;
    };
    
    
     ISR TimerISR{
    	CATEGORY = 2;
    	SOURCE = "TIMER1_COMPA";
    };
};


//bsw.h

#ifndef BSW_H_
#define BSW_H_

#include "ee.h"
#include "Arduino.h"

#ifdef __cplusplus
extern "C"{
#endif

void mdelay(unsigned long delay_ms);

void printfSerial(const char *fmt, ... );

#ifdef __cplusplus
}
#endif

#endif /* BSW_H_ */
